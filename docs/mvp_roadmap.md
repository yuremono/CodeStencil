# CodeStencil MVP 機能範囲と開発ロードマップ

> **作成日**: 2026-02-07
> **バージョン**: 1.0.0
> **担当**: @member3

---

## 概要

CodeStencilはAI駆動のインテリジェントコードテンプレートプラットフォームです。本ドキュメントではMVP（Minimum Viable Product）の機能範囲と開発ロードマップを定義します。

---

## 1. MVP機能範囲

### 1.1 必須機能（v1.0で必ず入れるもの）

#### コア機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| **AST解析エンジン** | Tree-sitterを使用したコードの構造解析 | P0 |
| **テンプレート管理** | テンプレートの作成・保存・取得・削除 | P0 |
| **基本テンプレート生成** | プロジェクトコンテキストに基づく基本テンプレート生成 | P0 |
| **ユーザー認証** | Email/Passwordによる認証（Supabase使用） | P0 |
| **基本UI** | テンプレート一覧、作成、プレビュー画面 | P0 |

#### テンプレート機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| **静的テンプレート** | 既存のスニペットをテンプレートとして登録 | P0 |
| **プレースホルダー変数** | テンプレート内の可変部分を定義 | P0 |
| **ファイル構成定義** | 複数ファイルのテンプレート構造を定義 | P0 |
| **言語サポート** | TypeScript, JavaScript, Python, Go の基本サポート | P0 |

---

### 1.2 優先度高い機能（v1.1〜v1.2）

#### AI機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| **LLM生成エンジン** | OpenAI/Claude APIを使用したテンプレート生成 | P1 |
| **RAG検索** | ベクトル検索による類似テンプレートの推奨 | P1 |
| **スタイル学習** | プロジェクトのコーディングスタイルを学習 | P1 |

#### エディタ連携
| 機能 | 説明 | 優先度 |
|------|------|--------|
| **VS Code拡張** | エディタから直接テンプレートを挿入 | P1 |
| **Language Server連携** | LSPプロトコルによるインテリジェンス | P2 |

---

### 1.3 将来的な機能（v2.0以降）

#### 高度なAI機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| **自動テスト生成** | テンプレート対応のテストコード生成 | P2 |
| **ドキュメント生成** | テンプレートの使用例ドキュメント自動生成 | P2 |
| **バリデーションエージェント** | 生成コードの静的解析・品質チェック | P2 |

#### コミュニティ機能
| 機能 | 説明 | 優先度 |
|------|------|--------|
| **テンプレート共有** | コミュニティテンプレートの共有・検索 | P2 |
| **評価・レビュー** | テンプレートの評価システム | P3 |

---

## 2. 開発ロードマップ

### フェーズ1: 基盤整備（週1-2）

#### 目標
プロジェクトの基本構造を構築し、開発環境を整える

#### タスク
- [x] リポジトリ初期化（monorepo構成: pnpm workspace）
- [ ] パッケージ構成定義
  - `apps/web`: Next.jsフロントエンド
  - `apps/api`: tRPCバックエンド
  - `packages/ui`: 共通UIコンポーネント
  - `packages/database`: Prismaスキーマ
  - `packages/ast-parser`: AST解析ライブラリ
- [ ] 開発環境設定
  - ESLint/Prettier設定
  - TypeScript設定
  - Husky pre-commit hooks
- [ ] インフラ選定
  - データベース: Supabase PostgreSQL
  - ホスティング: Vercel
  - 認証: Supabase Auth
  - ストレージ: Supabase Storage

#### 依存関係
なし（最初のフェーズ）

#### 完了基準
- ローカル開発環境で `pnpm dev` が動作する
- データベーススキーマの初期バージョンが定義されている

---

### フェーズ2: コア機能実装（週3-5）

#### 目標
テンプレートの作成・保存・取得の基本機能を実装する

#### タスク
- [ ] データベーススキーマ実装
  - ユーザーテーブル
  - テンプレートテーブル
  - プレースホルダーテーブル
  - ファイル構成テーブル
- [ ] AST解析ライブラリ実装
  - Tree-sitterラッパー
  - TypeScriptパーサー
  - Pythonパーサー
  - Goパーサー
- [ ] tRPCルーター実装
  - テンプレートCRUDエンドポイント
  - ユーザー認証ミドルウェア
- [ ] テンプレートエンジン実装
  - プレースホルダー置換
  - 複数ファイル生成
  - 条件分岐対応（基本）

#### 依存関係
フェーズ1の完了

#### 完了基準
- API経由でテンプレートのCRUDが可能
- AST解析によるコード構造抽出が可能

---

### フェーズ3: UI/UX実装（週4-6）

#### 目標
ユーザーが操作可能なインターフェースを実装する

#### タスク
- [ ] 認証画面
  - サインアップ
  - サインイン
  - パスワードリセット
- [ ] ダッシュボード
  - テンプレート一覧表示
  - 検索・フィルター機能
  - タグによる分類
- [ ] テンプレートエディタ
  - コードエディタ（Monaco Editor）
  - プレビュー機能
  - プレースホルダー定義UI
  - ファイル構成ツリー
- [ ] テンプレート挿入機能
  - 変数入力フォーム
  - コード生成プレビュー
  - クリップボードコピー

#### 依存関係
フェーズ2の完了

#### 完了基準
- ユーザー登録からテンプレート使用までの一連のフローが完了する

---

### フェーズ4: テストとリリース（週2-3）

#### 目標
品質を保証し、本番環境へリリースする

#### タスク
- [ ] テスト実装
  - ユニットテスト（Vitest）
  - 結合テスト（tRPCルーター）
  - E2Eテスト（Playwright）
  - カバレッジ80%以上
- [ ] パフォーマンス最適化
  - AST解析のキャッシュ
  - データベースクエリ最適化
  - フロントエンドのバンドル最適化
- [ ] セキュリティレビュー
  - 認証・認可の確認
  - 入力バリデーション
  - レート制限
- [ ] デプロイ設定
  - Vercel設定
  - 環境変数管理
  - データベースマイグレーション

#### 依存関係
フェーズ3の完了

#### 完了基準
- 本番環境でアプリケーションが動作する
- 主要なユーザーフローのE2Eテストがパスする
- セキュリティチェックが完了している

---

## 3. 技術的負債管理

### 3.1 最初から避けるべきアンチパターン

#### アーキテクチャ
| アンチパターン | 対策 |
|---------------|------|
| **モノリスへの機能追加** | monorepo構造でパッケージを明確に分離する |
| **循環依存** | パッケージ間の依存関係を一方向に制限する |
| **Godオブジェクト** | 単一責任の原則を守り、小さなモジュールに分割する |

#### データベース
| アンチパターン | 対策 |
|---------------|------|
| **N+1クエリ** | Prismaのinclude/selectを適切に使用 |
| **インデックス不足** | 検索フィールドには必ずインデックスを追加 |
| **スキーマの破壊的変更** | マイグレーションファイルを必ず作成する |

#### フロントエンド
| アンチパターン | 対策 |
|---------------|------|
| **prop drilling** | React ContextまたはZustandを使用 |
| **巨大なコンポーネント** | 200行以下を目安に分割する |
| **useEffectの乱用** | サーバー側でデータを取得する（tRPC経由） |

#### バックエンド
| アンチパターン | 対策 |
|---------------|------|
| **認証・認可の忘却** | ミドルウェアで一律チェックする |
| **エラーハンドリング不足** | tRPCのエラー形式を統一する |
| **APIバージョニング未考慮** | tRPCの型安全性を活かし、破壊的変更を避ける |

---

### 3.2 品質メトリクス

開発開始時に以下のメトリクスを導入する

| メトリクス | 目標値 |
|-----------|--------|
| テストカバレッジ | 80%以上 |
| バンドルサイズ（初期ロード） | 200KB以下 |
| Lighthouseパフォーマンススコア | 90以上 |
| APIレスポンスタイム（p95） | 500ms以下 |
| TypeScript厳格モード | 有効 |

---

## 4. 週次スプリト計画

### スプリント1（週1-2）: 基盤整備
- フェーズ1の完了

### スプリント2（週3-4）: データベースとAST
- データベーススキーマ実装
- AST解析ライブラリ基本実装

### スプリント3（週5-6）: APIとテンプレートエンジン
- tRPCルーター実装
- テンプレートエンジン実装

### スプリント4（週7-8）: 認証と基本UI
- 認証画面実装
- テンプレート一覧画面実装

### スプリント5（週9-10）: エディタとプレビュー
- テンプレートエディタ実装
- プレビュー機能実装

### スプリント6（週11-12）: テストと最適化
- テスト実装
- パフォーマンス最適化
- セキュリティレビュー

### スプリント7（週13-14）: デプロイとリリース
- 本番デプロイ
- ベータテスト
- v1.0リリース

---

## 5. リスク管理

| リスク | 影響 | 緩和策 |
|--------|------|--------|
| AST解析の複雑性 | 高 | 既存のTree-sitterライブラリを活用し、独自実装を避ける |
| LLM APIのコスト | 中 | キャッシュ戦略と使用量制限を実装 |
| パフォーマンス問題 | 中 | 早期からパフォーマンス計測を行う |
| セキュリティ脆弱性 | 高 | 定期的なセキュリティレビューを実施 |

---

## 6. 成功の定義

MVPの成功を以下の指標で定義する

- [ ] ユーザーがアカウントを作成できる
- [ ] テンプレートを作成・保存・取得できる
- [ ] AST解析でコード構造を抽出できる
- [ ] プレビュー機能でテンプレートを確認できる
- [ ] 本番環境で安定して動作する
- [ ] テストカバレッジが80%以上

---

## 7. 次のアクション

1. フェーズ1のタスクを開始する
2. 各メンバーに担当タスクを割り当てる
3. 週次ミーティングを設定し、進捗を追跡する

---

**更新履歴**:
- 2026-02-07: 初版作成（@member3）
